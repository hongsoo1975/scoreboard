<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>스코어보드 디자인 편집기</title>
<style>
  body{font-family:"Noto Sans KR",sans-serif;background:#0b1220;color:#e5e7eb;margin:0;}
  .container{max-width:1000px;margin:20px auto;padding:0 20px;}
  .card{background:#111827;padding:20px;border-radius:12px;}
  h2{margin:0 0 16px;font-size:20px;font-weight:900;}
  .row{display:flex;gap:12px;align-items:center;margin:10px 0;}
  label{width:160px;font-weight:700;}
  input{flex:1;padding:8px;border-radius:8px;border:1px solid #334155;background:#0b1220;color:#e5e7eb;}
  input[type="color"]{max-width:120px;height:40px;}
  .actions{display:flex;gap:10px;margin-top:16px;}
  button{padding:10px 14px;border-radius:8px;border:0;font-weight:800;cursor:pointer;background:#3b82f6;color:#fff;}
  button.secondary{background:#374151;}
  .preview{margin-top:16px;border-radius:12px;overflow:hidden;border:1px solid #1f2937;}
  iframe{width:100%;height:320px;border:0;background:transparent;}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h2>스코어보드 디자인 편집기</h2>

    <div class="row"><label>폰트 패밀리</label><input id="font_family" type="text" value='Noto Sans KR, Montserrat, sans-serif' /></div>
    <div class="row">
      <label>팀명 크기(px)</label><input id="team_font_size" type="number" value="32" />
      <label style="width:auto;">점수 크기(px)</label><input id="score_font_size" type="number" value="80" />
    </div>
    <div class="row">
      <label>세트 글자(px)</label><input id="sets_font_size" type="number" value="20" />
      <label style="width:auto;">메타 글자(px)</label><input id="meta_font_size" type="number" value="18" />
    </div>
    <div class="row"><label>VS 크기(px)</label><input id="vs_font_size" type="number" value="36" /></div>

    <div class="row"><label>포인트 색</label><input id="accent" type="color" value="#ffd45e" /></div>
    <div class="row"><label>배경색</label><input id="bg" type="text" value="rgba(0,0,0,0.5)" /></div>
    <div class="row"><label>테두리 색</label><input id="border" type="text" value="rgba(255,255,255,0.18)" /></div>
    <div class="row"><label>섀도우</label><input id="shadow" type="text" value="0 10px 28px rgba(0,0,0,.35)" /></div>
    <div class="row">
      <label>모서리 반경(px)</label><input id="radius" type="number" value="12" />
      <label style="width:auto;">간격(px)</label><input id="gap" type="number" value="40" />
    </div>

    <div class="actions">
      <button id="applyBtn">미리보기 적용</button>
      <button id="saveBtn">서버에 저장</button>
      <button id="loadBtn" class="secondary">현재 불러오기</button>
    </div>

    <div class="preview">
      <iframe id="previewFrame" src="index.html" title="미리보기"></iframe>
    </div>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx0zi0ZIMlvnCro-ggI89C68aVHupn3A-2autiHJTCO20np2ctt3lZnLTf_DSX0bbuz/exec";
const ADMIN_TOKEN = "jceGvOOeuPd0-vRclIuSQS7Pm-n7-BEfcK-sifBsNnRHX4zTzXfLdkWk2_4XF6u8";

function buildDesign(){
  return {
    "font-family": document.getElementById('font_family').value,
    "team-font-size": document.getElementById('team_font_size').value + "px",
    "score-font-size": document.getElementById('score_font_size').value + "px",
    "sets-font-size": document.getElementById('sets_font_size').value + "px",
    "meta-font-size": document.getElementById('meta_font_size').value + "px",
    "vs-font-size": document.getElementById('vs_font_size').value + "px",
    "accent": document.getElementById('accent').value,
    "bg": document.getElementById('bg').value,
    "border": document.getElementById('border').value,
    "shadow": document.getElementById('shadow').value,
    "radius": document.getElementById('radius').value + "px",
    "gap": document.getElementById('gap').value + "px"
  };
}

function applyPreview(design){
  const iframe = document.getElementById('previewFrame');
  iframe.contentWindow.postMessage({type:'applyDesign', design}, '*');
}

document.getElementById('applyBtn').addEventListener('click', ()=>{
  applyPreview(buildDesign());
});

document.getElementById('saveBtn').addEventListener('click', async ()=>{
  const design = buildDesign();
  try{
    const res = await fetch(API_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({action:'update_design', design, token:ADMIN_TOKEN})
    });
    const j = await res.json();
    if(j.ok) alert('디자인이 저장되었습니다.');
    else alert('저장 실패: '+(j.error||'unknown'));
  }catch(e){ alert('저장 중 오류'); }
});

document.getElementById('loadBtn').addEventListener('click', async ()=>{
  try{
    const res = await fetch(API_URL);
    const j = await res.json();
    const cfg = j.config || {};
    const d = cfg.design ? (typeof cfg.design === 'string' ? JSON.parse(cfg.design) : cfg.design) : {};
    const set = (id,key,postfix='')=>{ if(d[key]) document.getElementById(id).value = d[key].replace(postfix,''); };
    set('font_family','font-family');
    set('team_font_size','team-font-size','px');
    set('score_font_size','score-font-size','px');
    set('sets_font_size','sets-font-size','px');
    set('meta_font_size','meta-font-size','px');
    set('vs_font_size','vs-font-size','px');
    set('accent','accent');
    set('bg','bg');
    set('border','border');
    set('shadow','shadow');
    set('radius','radius','px');
    set('gap','gap','px');
    applyPreview(d);
  }catch(e){ alert('불러오기 실패'); }
});
</script>
</body>
</html>