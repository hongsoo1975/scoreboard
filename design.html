<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scoreboard Design Editor</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:20px;background:#f3f4f6;color:#111;}
  .panel{background:#fff;padding:16px;border-radius:8px;max-width:900px;box-shadow:0 2px 8px rgba(0,0,0,0.06);}
  .row{display:flex;gap:12px;align-items:center;margin-bottom:10px;}
  label{width:160px;font-weight:700;}
  input[type="text"], input[type="color"], select{flex:1;padding:8px;border:1px solid #ddd;border-radius:6px;}
  input[type="number"]{width:120px;padding:8px;border:1px solid #ddd;border-radius:6px;}
  button{padding:10px 14px;border-radius:6px;border:0;background:#10b981;color:#fff;font-weight:700;cursor:pointer;}
  .preview{margin-top:16px;border-radius:8px;overflow:hidden;}
  iframe{width:100%;height:260px;border:1px solid #e5e7eb;border-radius:6px;}
</style>
</head>
<body>
<div class="panel">
  <h2>Design Editor</h2>

  <div class="row">
    <label>API URL</label>
    <input id="apiUrl" type="text" value="https://script.google.com/macros/s/AKfycbxBzzmxN7MAFuwQjLrNt4iSjj91hQZxoRjZ_FH1phuEa0KAxKe0Mum27JwAukmRH1GNeg/exec" />
  </div>

  <div class="row">
    <label>Admin Token</label>
    <input id="adminToken" type="text" value="jceGvOOeuPd0-vRclIuSQS7Pm-n7-BEfcK-sifBsNnRHX4zTzXfLdkWk2_4XF6u8" />
  </div>

  <div class="row">
    <label>Font Family</label>
    <input id="font_family" type="text" placeholder="e.g. Noto Sans KR, Arial" value="Noto Sans KR, Arial, sans-serif" />
  </div>

  <div class="row">
    <label>Team Font Size (px)</label>
    <input id="team_font_size" type="number" value="36" />
    <label style="width:auto;margin-left:12px;">Score Font Size (px)</label>
    <input id="score_font_size" type="number" value="96" />
  </div>

  <div class="row">
    <label>Sets Font Size (px)</label>
    <input id="sets_font_size" type="number" value="20" />
    <label style="width:auto;margin-left:12px;">Meta Font Size (px)</label>
    <input id="meta_font_size" type="number" value="18" />
  </div>

  <div class="row">
    <label>Border Color</label>
    <input id="border_color" type="color" value="#ffffff" />
    <label style="width:auto;margin-left:12px;">Border Width (px)</label>
    <input id="border_width" type="number" value="6" />
  </div>

  <div class="row">
    <label>Cell Background</label>
    <input id="cell_bg" type="text" value="rgba(0,0,0,0.45)" />
    <label style="width:auto;margin-left:12px;">Accent Color</label>
    <input id="accent" type="color" value="#ffcc00" />
  </div>

  <div style="margin-top:12px;display:flex;gap:8px;">
    <button id="applyBtn">Apply Preview</button>
    <button id="saveBtn">Save to Server</button>
    <button id="loadBtn" class="secondary">Load Current</button>
  </div>

  <div class="preview">
    <iframe id="previewFrame" src="index.html" title="Preview"></iframe>
  </div>
</div>

<script>
function getApi(){ return document.getElementById('apiUrl').value.trim(); }
function getToken(){ return document.getElementById('adminToken').value.trim(); }

function buildDesignJson(){
  return {
    "font-family": document.getElementById('font_family').value || "Noto Sans KR, Arial, sans-serif",
    "team-font-size": (document.getElementById('team_font_size').value || 36) + "px",
    "score-font-size": (document.getElementById('score_font_size').value || 96) + "px",
    "sets-font-size": (document.getElementById('sets_font_size').value || 20) + "px",
    "meta-font-size": (document.getElementById('meta_font_size').value || 18) + "px",
    "border-color": document.getElementById('border_color').value || "#ffffff",
    "border-width": (document.getElementById('border_width').value || 6) + "px",
    "cell-bg": document.getElementById('cell_bg').value || "rgba(0,0,0,0.45)",
    "accent": document.getElementById('accent').value || "#ffcc00"
  };
}

function applyPreview(design){
  const iframe = document.getElementById('previewFrame');
  iframe.contentWindow.postMessage({type:'applyDesign', design}, '*');
}

document.getElementById('applyBtn').addEventListener('click', ()=>{
  const d = buildDesignJson();
  applyPreview(d);
});

document.getElementById('saveBtn').addEventListener('click', async ()=>{
  const url = getApi();
  const token = getToken();
  if(!url || !token) return alert('API URL과 Admin Token을 입력하세요');
  const design = buildDesignJson();
  try{
    const res = await fetch(url, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({action:'update_design', design, token})});
    const j = await res.json();
    if(j.ok) alert('Design saved');
    else alert('Save failed');
  }catch(e){ console.error(e); alert('Save error'); }
});

document.getElementById('loadBtn').addEventListener('click', async ()=>{
  const url = getApi();
  if(!url) return alert('API URL을 입력하세요');
  try{
    const res = await fetch(url);
    const j = await res.json();
    const cfg = j.config || {};
    const d = cfg.design ? (typeof cfg.design === 'string' ? JSON.parse(cfg.design) : cfg.design) : {};
    document.getElementById('font_family').value = d['font-family'] || "Noto Sans KR, Arial, sans-serif";
    document.getElementById('team_font_size').value = parseInt((d['team-font-size']||'36px').replace('px',''));
    document.getElementById('score_font_size').value = parseInt((d['score-font-size']||'96px').replace('px',''));
    document.getElementById('sets_font_size').value = parseInt((d['sets-font-size']||'20px').replace('px',''));
    document.getElementById('meta_font_size').value = parseInt((d['meta-font-size']||'18px').replace('px',''));
    document.getElementById('border_color').value = d['border-color'] || '#ffffff';
    document.getElementById('border_width').value = parseInt((d['border-width']||'6px').replace('px',''));
    document.getElementById('cell_bg').value = d['cell-bg'] || 'rgba(0,0,0,0.45)';
    document.getElementById('accent').value = d['accent'] || '#ffcc00';
    applyPreview(d);
  }catch(e){ console.error(e); alert('Load error'); }
});
</script>
</body>
</html>
